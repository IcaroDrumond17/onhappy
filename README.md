# üöÄ Projeto Fullstack com Docker: Laravel (API) + Vue.js (Frontend)

Este projeto oferece uma estrutura completa para iniciar aplica√ß√µes com **API em Laravel** e **Frontend em Vue.js** utilizando **Docker**, sem a necessidade de instalar PHP, Composer, Node.js ou MySQL localmente.

---

## üê≥ Requisitos

- [Docker](https://www.docker.com/)
- [Docker Compose](https://docs.docker.com/compose/)

---

## üìÅ Estrutura dos Servi√ßos (docker-compose.yml)

| Servi√ßo    | Fun√ß√£o                         |
| ---------- | ------------------------------ |
| `api`      | Container PHP com Laravel      |
| `mysql`    | Banco de dados MySQL           |
| `composer` | Composer para instalar pacotes |
| `vue`      | Vite + Vue                     |

---

### 1. üêô Clone ou baixe o projeto

```bash
git clone https://github.com/seu-usuario/seu-projeto.git
cd onhappy-project
```

#### üèóÔ∏è Estrutura do projeto:

- üìÅ root

```
/onhappy-project/
‚îú‚îÄ‚îÄ backend/      # Laravel (via Docker)
‚îú‚îÄ‚îÄ frontend/     # Vue 3 + Vite (via Docker)
‚îú‚îÄ‚îÄ docker/       # Dockerfiles
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ README.md
```

- üìÅ backend (API - Laravel)

```
/onhappy-project/backend/
‚îú‚îÄ‚îÄ app/
‚îú‚îÄ‚îÄ bootstrap/
‚îú‚îÄ‚îÄ config/
‚îú‚îÄ‚îÄ database/
‚îú‚îÄ‚îÄ routes/
‚îú‚îÄ‚îÄ storage/
‚îú‚îÄ‚îÄ tests/
‚îú‚îÄ‚îÄ vendor/
‚îú‚îÄ‚îÄ .editorconfig
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ .gitattributes
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ artisan
‚îú‚îÄ‚îÄ composer.json
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ phpunit.xml
```

- üìÅ front (VueJs)

```
/onhappy-project/frontend/
‚îú‚îÄ‚îÄ .vscode/
‚îú‚îÄ‚îÄ public/
‚îú‚îÄ‚îÄ src/
‚îú‚îÄ‚îÄ .editorconfig
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ .gitattributes
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ .prettierrc.json
‚îú‚îÄ‚îÄ auto-imports.d.ts
‚îú‚îÄ‚îÄ components.d.ts
‚îú‚îÄ‚îÄ components.d.ts
‚îú‚îÄ‚îÄ .env.d.json
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ eslint.config.ts
‚îú‚îÄ‚îÄ index.html
‚îú‚îÄ‚îÄ tsconfig.app.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îú‚îÄ‚îÄ tsconfig.node.json
‚îú‚îÄ‚îÄ vite.config.ts
```

#### üìù Observa√ß√£o para usu√°rios Windows (com WSL2)

- Ao instalar as depend√™ncias do projeto no Windows, √© comum enfrentar problemas de permiss√£o relacionados √† cria√ß√£o de pastas e arquivos pelo Docker.

- Para evitar esses problemas, configurei o docker-compose para usar duas vari√°veis de ambiente: UID (ID do usu√°rio) e GID (ID do grupo). Essas vari√°veis devem ser definidas em um arquivo .env localizado no mesmo n√≠vel do arquivo docker-compose.yml (raiz do projeto).

- Para facilitar, basta copiar o arquivo .env.example para .env e ajustar os valores conforme seu ambiente.

- Essa configura√ß√£o √© recomendada mesmo se voc√™ n√£o estiver usando Docker Desktop no Windows, pois ajuda a manter as permiss√µes corretas nos volumes compartilhados.

#### üñ•Ô∏è Como descobrir seu UID e GID no Linux ou WSL2:

```bash
echo $UID      # mostra o ID do usu√°rio
id -g         # mostra o ID do grupo
```

- Valores Padr√£o

UID=1000
GID=1000

> Copie esses valores e cole no arquivo .env (na raiz do projeto) que voc√™ vai criar baseado no .env.example.

#### üñ•Ô∏è No Windows (sem WSL)

- O Windows n√£o tem UID/GID, pois n√£o usa sistema de permiss√µes Unix.

- Mesmo assim, manter o .env com valores padr√µes (UID=1000 e GID=1000) geralmente funciona.

- Se usar WSL2, deve pegar os valores pelo terminal WSL (como acima).

- Essa configura√ß√£o ajuda o Docker a rodar os containers com as permiss√µes corretas no sistema de arquivos compartilhado.

- Ap√≥s criar seu .env (na raiz do projeto) com os valores corretos, rode seus containers normalmente com docker compose up ou os comandos que j√° est√° acostumado.

### 2. üê≥ Docker

#### üì¶ Containers

```bash
# Prieiro copie o env da raiz do projeto para validar as quest√µes de permiss√µes do docker
cp .env.example .env

# Subir (Primeira vez)
docker compose up -d --build

# Subir
docker compose up

# Verificar status
docker compose ps

# Finalizar containers
docker compose down -v

```

### 3. üî• Laravel

```bash
# Instalar as depend√™ncias (vendor)
docker compose run --rm api composer install

# Ou: Para ajudar em casos de conflitos ao baixar depend√™ncias de arquivos/diret√≥rios com letras mai√∫sculas/min√∫sculas diferentes
docker compose run --rm api composer install --prefer-dist

# Caso necess√°rio, sobe o container do VueJs
docker compose up api

# Replicar o .env
docker compose exec api cp .env.example .env

# Gera a chave da aplica√ß√£o
docker compose exec api php artisan key:generate

```

#### üîê Instala√ß√£o do JWT (Autentica√ß√£o)

Instala a biblioteca JWT para autentica√ß√£o via tokens.

> üí° _Geralmente, essa depend√™ncia j√° estar√° instalada ao rodar `composer install`, mas inclu√≠ este comando por garantia:_

```bash
docker compose run --rm composer require tymon/jwt-auth
```

- Chave secreta

```bash
# publica o arquivo de configura√ß√£o config/jwt.php da biblioteca tymon/jwt-aut
docker compose exec api php artisan vendor:publish --provider="Tymon\JWTAuth\Providers\LaravelServiceProvider"

# Gera a chave secreta (secret) e salva no .env
docker compose exec api php artisan jwt:secret
```

#### üóÑÔ∏è Gerar Base de Dados com Dados Simulados

Use os comandos abaixo para criar ou reiniciar o banco de dados da API:

> üí° Observa√ß√£o: Pode ser necess√°rio aguardar alguns segundos ap√≥s subir os containers para que o banco de dados MySQL esteja totalmente pronto e as tabelas possam ser criadas com sucesso. Caso ocorra erro de conex√£o, tente executar o comando novamente ap√≥s alguns segundos.

```bash
# Executa as migrations normalmente (cria as tabelas)
docker compose exec api php artisan migrate

# OU: Remove todas as tabelas, recria e popula com dados fict√≠cios (seeds)
docker compose run --rm api php artisan migrate:fresh --seed
```

#### üß™ Rotina de testes (Laravel)

- Escolhi fazer testes de Feature em vez de testes unit√°rios para garantir que o sistema funcione de forma integrada, al√©m de testar regras de neg√≥cio, validar rotas, permiss√µes, respostas HTTP, intera√ß√µes com o banco de dados e autentica√ß√£o.

```bash
# lista de testes
docker compose run --rm api php artisan test --list-tests

# Roda todos os testes
docker compose run --rm api php artisan test

# Testar orders
docker compose run --rm api php artisan test tests/Feature/OrderControllerTest.php

# Testar atualiza√ß√£o de status do pedido
docker compose run --rm api php artisan test tests/Feature/OrderStatusTest.php

# Testar notifica√ß√µes
docker compose run --rm api php artisan test tests/Feature/NotificationControllerTest.php
```

### 4. üü¢ VueJS

```bash
# Instalar as depend√™ncias (node_modules)
docker compose run --rm vue npm install

# Replicar o .env
docker compose exec vue cp .env.example .env

# Caso necess√°rio, sobe o container do VueJs
docker compose up vue

```

### 5. ‚ö° Comandos √∫teis

5.1 ‚û°Ô∏è Criar usu√°rios default

| E-mail            | Password | Tipo  |
| ----------------- | -------- | ----- |
| admin@teste.com   | `1234`   | ADMIN |
| default@teste.com | `1234`   | COMUM |

```bash
# Gerar tabelas
docker compose run --rm api php artisan db:seed

# Apaga todas as tabelas e recria (roda o migrate fresh + seed)
docker compose run --rm api php artisan migrate:fresh --seed
```

5.2 üìä Testar conex√£o com a base de dados MySQL

```bash
# logs 
docker compose logs mysql

# Entrar no terminal do container
docker compose exec mysql bash

# Acessar
mysql -u laravel -p
# Enter password: laravel
```

5.3 üìä Ver tabelas

```bash
# shell do container.
docker exec -it laravel-mysql bash

# Acessar
mysql -uroot -p
# Enter password: root

# Visualizar tabelas (aqui pode se dar comandos SQL)
SHOW DATABASES;

# Exemplos:

USE laravel;

SHOW TABLES;

DESCRIBE users;

SHOW COLUMNS FROM users;

SELECT * FROM users LIMIT 10;
```

| Servi√ßo | URL/Host         |
| ------- | ---------------- |
| MySQL   | `127.0.0.1:3306` |
| Usu√°rio | `laravel`        |
| Senha   | `laravel`        |

5.4 ‚ö° Limpar caches da API

```bash
docker compose run --rm api php artisan config:clear
docker compose run --rm api php artisan cache:clear
docker compose run --rm api php artisan config:cache
docker compose run --rm api php artisan route:clear
```

5.5 üîë Listar rotas da API

```bash
docker compose run --rm api php artisan route:list
```

5.6 Verificar vari√°veis de ambiente da API

```bash
docker compose run --rm api php artisan env
```

#### üìù Observa√ß√µes Finais

- ‚ö†Ô∏èao instalar as dependencias do laravel, em sistemas com filesystem case-insensitive (como Windows ou WSL), o Composer pode apresentar erros ao instalar depend√™ncias, devido a conflitos de nomes com letras mai√∫sculas/min√∫sculas (ex: Ramsey/Uuid vs ramsey/uuid) e permiss√µes de arquivos.

Para evitar problemas:

- Use o comando composer install --prefer-dist para evitar extra√ß√µes problem√°ticas com unzip.

- Garanta permiss√µes corretas nas pastas vendor, storage e bootstrap/cache.

- Em ambiente Docker, recomenda-se configurar a execu√ß√£o do container com o mesmo UID/GID do host para evitar conflitos de permiss√µes em volumes.

```bash
docker compose run --rm api composer install --prefer-dist
```

- ‚ö†Ô∏è Para testar a responsividade no navegador, ao utilizar a ferramenta de inspe√ß√£o para simular dispositivos m√≥veis, lembre-se de atualizar a p√°gina. Isso garante que os scripts JavaScript respons√°veis por ajustar elementos conforme o tamanho da tela funcionem corretamente.

#### Comandos padr√£o Docker

| A√ß√£o                      | Comando                                |
| ------------------------- | -------------------------------------- |
| Subir containers          | `docker compose up -d`                 |
| Derrubar containers       | `docker compose down`                  |
| Executar Artisan          | `docker compose exec api php artisan`  |
| Rodar Composer            | `docker compose run --rm composer`     |
| Acessar container do PHP  | `docker compose exec api bash`         |
| Rodar scripts npm         | `docker compose exec node npm run dev` |
| Acessar container do Node | `docker compose exec node bash`        |

#### Documenta√ß√µes Oficiais

| Tecnologia  | Link para a Documenta√ß√£o Oficial üìò                        |
| ----------- | ---------------------------------------------------------- |
| üî• Laravel  | [https://laravel.com/docs](https://laravel.com/docs)       |
| üü¢ Vue.js   | [https://vuejs.org/guide](https://vuejs.org/guide)         |
| üê≥ Docker   | [https://docs.docker.com](https://docs.docker.com)         |
| üì¶ Composer | [https://getcomposer.org/doc](https://getcomposer.org/doc) |
| üß∞ Node.js  | [https://nodejs.org/en/docs](https://nodejs.org/en/docs)   |
| ‚ö° Vite     | [https://vitejs.dev/guide](https://vitejs.dev/guide)       |
